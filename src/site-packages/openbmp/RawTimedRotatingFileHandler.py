"""OpenBMP MRT

  Copyright (c) 2013-2016 Cisco Systems, Inc. and others.  All rights reserved.
  This program and the accompanying materials are made available under the
  terms of the Eclipse Public License v1.0 which accompanies this distribution,
  and is available at http://www.eclipse.org/legal/epl-v10.html

  .. moduleauthor:: Tim Evens <tievens@cisco.com>
"""

import logging
import logging.handlers


class RawTimedRotatingFileHandler(logging.handlers.TimedRotatingFileHandler):
    """
        Modified logging.handlers.TimedRotatingFileHandler to add support for
        binary/raw logging.
    """

    def emit(self, record):
        """
        Emit a record.

        Output the record to the file, catering for rollover as described
        in doRollover().
        """
        try:
            if self.shouldRollover(record):
                self.doRollover()

            # override logging.FileHandler.emit() and logging.StreamHandler.emit()
            if self.stream is None:
                self.stream = self._open()

            stream = self.stream

            # write message as is, no formatting and no newline
            stream.write(record.getMessage())

        except (KeyboardInterrupt, SystemExit):
            raise
        except:
            self.handleError(record)